<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Playnfinity</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#a855f7">
  <style>
    /* FULL $1B AESTHETIC — NO COMPROMISE */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { 
      height: 100%; 
      overflow: hidden; 
      background: linear-gradient(135deg, #1a0033 0%, #330066 50%, #660033 100%);
      background-attachment: fixed;
      font-family: 'Segoe UI', system-ui, sans-serif;
      color: white;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: pan-y; /* allows swipe but blocks accidental zoom */
    }

    #yom-player {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      border: none;
      z-index: 1;
    }

    /* PREMIUM GLASS TITLE */
    .title {
      position: fixed;
      top: 1.5rem;
      left: 1.5rem;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      padding: 0.9rem 1.4rem;
      border-radius: 3rem;
      font-weight: 700;
      font-size: 1.1rem;
      z-index: 100;
      border: 1px solid rgba(168, 85, 247, 0.3);
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      max-width: 70%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* CLEAN CLOSE BUTTON */
    .close {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      width: 52px;
      height: 52px;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(16px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.9rem;
      font-weight: 300;
      z-index: 1001;
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.2);
      transition: all 0.2s;
    }
    .close:hover { background: rgba(220, 38, 38, 0.8); }

    /* $1B TIKTOK ACTIONS — BIGGER, BOLDER, SEXIER */
    .actions {
      position: fixed;
      right: 1rem;
      bottom: 110px;
      display: flex;
      flex-direction: column;
      gap: 1.8rem;
      z-index: 100;
    }

    .btn {
      width: 76px;
      height: 76px;
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: 3px solid rgba(255,255,255,0.3);
      box-shadow: 0 12px 40px rgba(0,0,0,0.6);
      position: relative;
    }

    .btn:hover {
      transform: translateY(-8px) scale(1.18);
      background: linear-gradient(135deg, #a855f7, #e0a8ff);
      border-color: #a855f7;
      box-shadow: 0 0 40px rgba(168, 85, 247, 0.8);
    }

    .btn:active {
      transform: scale(1.35);
    }

    .btn .icon {
      font-size: 2.4rem;
      margin-bottom: 0.4rem;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.6));
    }

    .btn .count {
      font-weight: 900;
      font-size: 1rem;
      text-shadow: 0 2px 10px black;
    }

    /* BOTTOM NAV — FLAWLESS */
    .nav {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: rgba(0,0,0,0.94);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255,255,255,0.12);
      padding: 0.9rem 0;
      display: flex;
      justify-content: space-around;
      z-index: 1000;
    }

    .nav img {
      width: 32px;
      height: 32px;
      filter: grayscale(100%) brightness(0.65);
      transition: all 0.25s;
    }

    .nav a:hover img,
    .nav a.active img {
      filter: none;
      transform: scale(1.15);
    }

    /* CUSTOM SCROLLBAR — SAME AS FEED */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(#a855f7, #c084fc);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover { background: #a855f7; }
  </style>
</head>
<body 
  oncontextmenu="return false
  onselectstart="return false"
  ondragstart="return false"
  onclick="event.preventDefault(); return false;">

  <iframe id="yom-player" allow="fullscreen; autoplay; encrypted-media; accelerometer; gyroscope; magnetometer; xr-spatial-tracking"></iframe>

  <div class="title" id="title">Loading...</div>
  <div class="close" onclick="history.back()">×</div>

  <div class="actions">
    <div class="btn" onclick="likeGame(event)">
      <div class="icon">Heart</div>
      <div class="count" id="likes">0</div>
    </div>
    <div class="btn" onclick="toggleComments(event)">
      <div class="icon">Chat</div>
      <div class="count" id="comments">0</div>
    </div>
    <div class="btn" onclick="shareGame(event)">
      <div class="icon">Share</div>
      <div class="count">Share</div>
    </div>
  </div>

  <nav class="nav">
    <a href="/"><img src="https://playnfinity.games/app/home.gr.png" data-active="https://playnfinity.games/app/home.ab.png"></a>
    <a href="/feed.html"><img src="https://playnfinity.games/app/letterp.gr.png" data-active="https://playnfinity.games/app/letterp.ab.png"></a>
    <a href="/explore.html"><img src="https://playnfinity.games/app/explore.gr.png" data-active="https://playnfinity.games/app/explore.ab.png"></a>
    <a href="/trending.html"><img src="https://playnfinity.games/app/fav.gr.png" data-active="https://playnfinity.games/app/fav.ab.png"></a>
    <a href="/profile.html"><img src="https://playnfinity.games/app/profile.gr.png" data-active="https://playnfinity.games/app/profile.ab.png"></a>
  </nav>

  <!-- ALL YOUR ORIGINAL SUPABASE + TRACKING LOGIC — 100% INTACT -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="track.js"></script>
  <script>
    // CLEAN URL
    if (location.pathname.includes('.html')) {
      history.replaceState(null, null, location.pathname.replace('.html', '') + location.search);
    }

    // TOTAL LOCKDOWN — LEFT CLICK DEAD, DEV TOOLS DEAD
    ['contextmenu','selectstart','dragstart'].forEach(ev => document.addEventListener(ev, e => e.preventDefault()));
    document.addEventListener('keydown', e => {
      if (e.key === 'F12' || (e.ctrlKey && e.shiftKey) || (e.ctrlKey && 'uicjs'.includes(e.key.toLowerCase()))) {
        e.preventDefault();
        e.stopPropagation();
      }
    }, true);

    const supabase = window.supabase.createClient(
      'https://yfrgxmpbdbkfwzwbtfrt.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlmcmd4bXBiZGJrZnd6d2J0ZnJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTMwMjcsImV4cCI6MjA3ODYyOTAyN30.A0tkw4gMg49E7-6oA8m8_FJev209UDeuvDDcxsCREWI'
    );

    const urlParams = new URLSearchParams(location.search);
    const gameId = urlParams.get('id') || '1';
    let gameData = null;

    // YOUR FULL ORIGINAL STATIC GAMES ARRAY (keep all 50+ games here)
    const staticGames = [
      { id: '1', title: "Valley of the Ancient", url: "https://yom.net/embed/valley-of-the-ancient", duration: 180, tags: "Exploration", likes: 456, comments: 89 },
      { id: '2', title: "K4 Rally", url: "https://yom.net/embed/k4-rally", duration: 120, tags: "Racing", likes: 789, comments: 123 },
      { id: '3', title: "Martians vs Roughnecks", url: "https://yom.net/embed/martians-vs-roughnecks", duration: 180, tags: "Action", likes: 312, comments: 45 }
      // ← PASTE ALL YOUR GAMES HERE — NO SHORTCUTS
    ];

    let currentIndex = staticGames.findIndex(g => g.id === gameId);
    if (currentIndex === -1) currentIndex = 0;

    async function loadGame() {
      let { data, error } = await supabase
        .from('games')
        .select('*')
        .eq('id', gameId)
        .single();

      if (error || !data) {
        gameData = staticGames[currentIndex];
      } else {
        gameData = data;
      }

      document.getElementById('yom-player').src = gameData.url;
      document.getElementById('title').textContent = gameData.title;
      document.getElementById('likes').textContent = gameData.likes || 0;
      document.getElementById('comments').textContent = gameData.comments || 0;

      if (typeof initTracking === 'function') {
        initTracking(gameId, gameData.duration || 180);
      }
    }

    function likeGame(e) {
      e.stopPropagation();
      const count = document.getElementById('likes');
      count.textContent = parseInt(count.textContent) + 1;

      supabase.from('game_interactions').insert({
        game_id: gameId,
        type: 'like',
        device_id: localStorage.getItem('device_id') || 'unknown'
      });
    }

    function toggleComments(e) {
      e.stopPropagation();
      // Future comment panel
    }

    function shareGame(e) {
      e.stopPropagation();
      const url = location.href;
      if (navigator.share) {
        navigator.share({ title: gameData.title, url });
      } else {
        navigator.clipboard.writeText(url);
        alert('Link copied to clipboard!');
      }
      supabase.from('game_interactions').insert({
        game_id: gameId,
        type: 'share'
      });
    }

    // BUTTERY SMOOTH SWIPE
    let startY = 0;
    const iframe = document.getElementById('yom-player');
    iframe.addEventListener('touchstart', e => startY = e.touches[0].screenY, {passive: true});
    iframe.addEventListener('touchend', e => {
      const deltaY = startY - e.changedTouches[0].screenY;
      if (Math.abs(deltaY) < 130) return;

      if (deltaY > 0) {
        // Swipe UP → next
        currentIndex = (currentIndex + 1) % staticGames.length;
      } else {
        // Swipe DOWN → prev
        currentIndex = currentIndex === 0 ? staticGames.length - 1 : currentIndex - 1;
      }

      const nextGame = staticGames[currentIndex];
      history.replaceState(null, null, `?id=${nextGame.id}`);
      loadGame(); // reloads everything cleanly
    });

    // INIT
    loadGame();
  </script>
</body>
</html>