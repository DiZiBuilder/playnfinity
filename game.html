<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Playnfinity</title>
  <link rel="manifest" href="/manifest.json">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;overflow:hidden;background:#000;color:#fff;font-family:-apple-system,system-ui,sans-serif;-webkit-user-select:none;user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;touch-action:pan-y}
    #game{position:fixed;top:0;left:0;width:100vw;height:100vh;border:none;z-index:1;pointer-events:none}
    #overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999;pointer-events:auto;background:transparent}
    .title{position:fixed;top:60px;left:50%;transform:translateX(-50%);z-index:10;background:rgba(0,0,0,.6);backdrop-filter:blur(30px);padding:12px 30px;border-radius:22px;font-weight:600;font-size:18px;border:1px solid rgba(255,255,255,.1);opacity:0;transition:opacity .5s}
    .title.show{opacity:1}
    .heart{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);font-size:120px;z-index:9999;pointer-events:none}
    .heart.show{animation:h 0.6s cubic-bezier(.18,.89,.32,1.28)}
    .pulltab{position:fixed;top:0;left:50%;transform:translateX(-50%);width:50px;height:40px;background:rgba(255,255,255,.15);backdrop-filter:blur(20px);border-radius:0 0 25px 25px;z-index:100}
    .panel{position:fixed;top:-100%;width:100%;height:420px;background:rgba(10,10,20,.97);backdrop-filter:blur(40px);border-radius:0 0 30px 30px;z-index:99;transition:top .5s cubic-bezier(.22,1,.36,1);padding-top:60px;text-align:center}
    .panel.open{top:0}
    .panel button{margin:15px auto;width:85%;padding:18px;border-radius:20px;border:none;background:#a855f7;color:#fff;font-size:18px;font-weight:600}
    .panel .close{background:#333}
    .navbar{position:fixed;bottom:0;width:100%;height:84px;background:rgba(0,0,0,.95);backdrop-filter:blur(3030px);border-top:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-around;align-items:center;z-index:1000}
    .navbar img{width:28px;height:28px;filter:brightness(0.7)}
    .navbar a.active img{filter:none}
    @keyframes h{0%{transform:translate(-50%,-50%) scale(0);opacity:1}50%{transform:translate(-50%,-50%) scale(1.4)}100%{transform:translate(-50%,-50%) scale(1);opacity:0}}
  </style>
</head>
<body>
  <iframe id="game" allow="fullscreen; accelerometer; gyroscope; magnetometer"></iframe>
  <div id="overlay"></div>
  <div class="title" id="title">Loading…</div>
  <div class="heart" id="heart">❤️</div>
  <div class="pulltab"></div>
  <div class="panel" id="panel">
    <h3 id="pt"></h3>
    <button onclick="share()">Share</button>
    <button onclick="fs()">Fullscreen</button>
    <button class="close" onclick="history.back()">Close</button>
  </div>
  <nav class="navbar">
    <a href="/"><img src="/app/home.gr.png"></a>
    <a href="/feed.html"><img src="/app/letterp.gr.png"></a>
    <a href="/explore.html"><img src="/app/explore.gr.png"></a>
    <a href="/trending.html"><img src="/app/fav.gr.png"></a>
    <a href="/profile.html"><img src="/app/profile.gr.png"></a>
  </nav>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient('https://yfrgxmpbdbkfwzwbtfrt.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlmcmd4bXBiZGJrZnd6d2J0ZnJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTMwMjcsImV4cCI6MjA3ODYyOTAyN30.A0tkw4gMg49E7-6oA8m8_FJev209UDeuvDDcxsCREWI');

    const games = [{id:'1',t:'Valley of the Ancient',u:'https://yom.net/embed/valley-of-the-ancient'},{id:'2',t:'K4 Rally',u:'https://yom.net/embed/k4-rally'},{id:'3',t:'Martians vs Roughnecks',u:'https://yom.net/embed/martians-vs-roughnecks'}];

    let i = games.findIndex(g=>g.id===new URLSearchParams(location.search).get('id'))||0;
    let cur = games[i];

    function load(){
      document.getElementById('game').src = cur.u + '?autoplay=1&v=' + new Date().getTime();
      document.getElementById('title').textContent = document.getElementById('pt').textContent = cur.t;
      document.getElementById('title').classList.add('show');
    }
    load();

    const o = document.getElementById('overlay');
    let taps=0,tapT=0,startY=0;

    o.onclick = () => {
      taps++; if(taps===1) tapT=setTimeout(()=>{taps=0},350);
      if(taps===2){ clearTimeout(tapT); taps=0;
        document.getElementById('heart').classList.add('show');
        setTimeout(()=>document.getElementById('heart').classList.remove('show'),600);
        supabase.from('game_interactions').insert({game_id:cur.id,type:'like'});
      }
    };

    o.ontouchstart = e => startY = e.touches[0].screenY;
    o.ontouchmove = e => {
      let d = startY - e.touches[0].screenY;
      document.querySelector('.pulltab').style.transform = `translateX(-50%) translateY(${Math.min(0,d)}px)`;
      if(d>80) document.getElementById('panel').classList.add('open');
    };
    o.ontouchend = e => {
      let d = startY - e.changedTouches[0].screenY;
      document.querySelector('.pulltab').style.transform = 'translateX(-50%)';
      if(Math.abs(d)<150){ if(d>60) document.getElementById('panel').classList.add('open'); return; }
      i = d>0 ? (i+1)%games.length : (i-1+games.length)%games.length;
      cur = games[i];
      history.replaceState(null,null,'?id='+cur.id);
      document.getElementById('title').classList.remove('show');
      document.getElementById('panel').classList.remove('open');
      load();
      supabase.from('game_interactions').insert({game_id:cur.id,type:'swipe'});
    };

    o.onwheel = e => { e.preventDefault(); i = e.deltaY>0 ? (i+1)%games.length : (i-1+games.length)%games.length; cur=games[i]; history.replaceState(null,null,'?id='+cur.id); document.getElementById('title').classList.remove('show'); load(); supabase.from('game_interactions').insert({game_id:cur.id,type:'swipe'}); };

    function share(){ navigator.share ? navigator.share({title:cur.t,url:location.href}) : navigator.clipboard.writeText(location.href); supabase.from('game_interactions').insert({game_id:cur.id,type:'share'}); }
    function fs(){ document.getElementById('game').requestFullscreen(); }
  </script>
</body>
</html>